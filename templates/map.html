{% extends "base.html" %}
{% set active_page = "map" %}

{% block title %}LineAgeMap â€” Map{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}">
{% endblock %}

{% block content %}
<div class="appFrameShell">
  <div class="appFrameCard">
    <div class="nav-family nav-family--wide">
      {% if public_slug %}
      <div class="pillTitle">PUBLIC FAMILY MAP</div>
      {% elif sample_id %}
      <div class="pillTitle">SAMPLE MAP</div>
      {% else %}
      <div class="pillTitle">MY FAMILY MAP</div>
      {% endif %}
    </div>

    <section class="mapShell" aria-label="Family Map">
      <div id="mapRoot" class="mapRoot">
        <div class="mapLegend">
          <div class="mapLegendTitle">Locations</div>
          <div class="mapLegendSub">Tap a country to zoom into regions and cities.</div>
        </div>

        <div id="mapAccordion" class="mapAccordion" aria-live="polite"></div>
      </div>
    </section>
  </div>
</div>
{% endblock %}

{% block scripts %}
{# Map accordion JS expects {people:[...]} so we use TREE endpoints. #}
{% if public_slug %}
{% set MAP_API_URL = "/api/public/" ~ public_slug ~ "/tree" %}
{% elif sample_id %}
{% set MAP_API_URL = "/api/sample/" ~ sample_id ~ "/tree" %}
{% elif current_user %}
{% set MAP_API_URL = "/api/tree/me" %}
{% else %}
{% set MAP_API_URL = "/api/sample/stark/tree" %}
{% endif %}

<script>
  window.MAP_API_URL = "{{ MAP_API_URL }}";
  if (!window.MAP_FAMILY_ID) window.MAP_FAMILY_ID = "stark";
</script>

<script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}